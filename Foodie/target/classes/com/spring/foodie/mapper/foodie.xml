<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="foodie">

	<select id="storeList" resultType="com.spring.foodie.model.SearchVO" parameterType="String">
	SELECT ROWNUM, STORE.CODE, STORE.TYPE, STORE.OPEN_STATUS, STORE.HYGINE,
	STORE.NAME, STORE.CALL,
	NVL(STORE.POSTCODE_NEW, STORE.POSTCODE_OLD) AS POSTCODE, NVL(STORE.ADDR_NEW, STORE.ADDR_OLD)
	AS ADDRESS
	FROM ( SELECT CODE, DIST_CODE, OPEN_STATUS, STATUS_DETAIL, CALL,
	POSTCODE_OLD, ADDR_OLD, POSTCODE_NEW, ADDR_NEW,
	NAME, BUSINESS_TYPE, COORDINATES_X, COORDINATES_Y, HYGIENE_TYPE AS HYGINE,
	BUSINESS_TYPE AS BUSINESS, TYPE,
	NAME || ADDR_OLD || ADDR_NEW || HYGIENE_TYPE || BUSINESS_TYPE || NAME ||
	ADDR_OLD || ADDR_NEW || HYGIENE_TYPE || BUSINESS_TYPE AS SEARCH_ALL
	FROM STORE_KOREA WHERE STATUS_DETAIL = '영업' ORDER BY NVL(POSTCODE_NEW,
	POSTCODE_OLD) ASC) STORE
	WHERE LOWER(REPLACE(TRIM(STORE.SEARCH_ALL), ' ', ''))
	LIKE LOWER(REPLACE(TRIM('%'||#{place}||'%'), ' ', '%'))
	ORDER BY ROWNUM ASC
	</select>
	
	<select id="getStoreDetail" parameterType="String" resultType="com.spring.foodie.model.SearchVO">
	SELECT ROWNUM, STORE.CODE, STORE.TYPE, STORE.OPEN_STATUS, STORE.HYGINE,
	STORE.NAME, STORE.CALL,
	NVL(STORE.POSTCODE_NEW, STORE.POSTCODE_OLD) AS POSTCODE, NVL(STORE.ADDR_NEW, STORE.ADDR_OLD)
	AS ADDRESS
	FROM ( SELECT CODE, DIST_CODE, OPEN_STATUS, STATUS_DETAIL, CALL,
	POSTCODE_OLD, ADDR_OLD, POSTCODE_NEW, ADDR_NEW,
	NAME, BUSINESS_TYPE, COORDINATES_X, COORDINATES_Y, HYGIENE_TYPE AS HYGINE,
	BUSINESS_TYPE AS BUSINESS, TYPE
	FROM STORE_KOREA WHERE STATUS_DETAIL = '영업') STORE
	WHERE STORE.code = #{code}
	</select>

</mapper>



